<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Food Coherence System | Clinical Calculator</title>
    <!-- PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* --- MEDICAL PROFESSIONAL THEME & CSS --- */
        :root {
            --primary-blue: #0047AB; /* Cobalt Blue [6] */
            --dark-navy: #0F172A;
            --medical-light: #F8FAFC;
            --text-grey: #334155;
            --alert-red: #B91C1C;
            --warning-orange: #EA580C;
            --success-green: #15803D;
            --white: #ffffff;
            --border-color: #cbd5e1;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: var(--text-grey); background-color: var(--medical-light); }

        /* TYPOGRAPHY */
        h1, h2, h3 { color: var(--dark-navy); font-weight: 700; }
        h1 { font-size: 2.5rem; letter-spacing: -0.02em; }
        h2 { font-size: 2rem; margin-bottom: 1rem; position: relative; }
        h2::after { content: ''; display: block; width: 60px; height: 4px; background: var(--primary-blue); margin-top: 10px; }
        
        /* HEADER */
        header { background-color: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: fixed; width: 100%; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary-blue); text-transform: uppercase; letter-spacing: 1px; }
        nav ul { display: flex; list-style: none; gap: 2rem; }
        nav a { text-decoration: none; color: var(--dark-navy); font-weight: 600; text-transform: uppercase; font-size: 0.9rem; }
        
        .hero { margin-top: 80px; background: linear-gradient(135deg, var(--dark-navy) 0%, var(--primary-blue) 100%); color: var(--white); padding: 4rem 2rem; text-align: center; }
        .container { max-width: 1200px; margin: 0 auto; padding: 4rem 2rem; }

        /* CALCULATOR SPECIFIC STYLES */
        .calc-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .calc-inputs { padding: 2rem; background-color: #f1f5f9; }
        .calc-dashboard { padding: 2rem; background-color: var(--white); position: relative; }

        /* Form Elements */
        label { display: block; font-weight: 700; margin-bottom: 0.5rem; color: var(--dark-navy); font-size: 0.9rem; }
        select, input[type="range"] { width: 100%; margin-bottom: 1.5rem; }
        
        select {
            padding: 0.8rem;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 1rem;
            background-color: var(--white);
        }

        .food-example-box {
            background-color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #475569;
            margin-bottom: 2rem;
            border-left: 4px solid var(--primary-blue);
        }

        /* Sliders */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            margin-top: -8px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }

        /* Dashboard Visuals */
        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(var(--score-color) var(--score-percent), #e2e8f0 0);
            margin: 0 auto 2rem auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
        }
        .score-inner {
            width: 160px;
            height: 160px;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .score-number { font-size: 3rem; font-weight: 800; color: var(--dark-navy); line-height: 1; }
        .score-label { font-size: 0.8rem; text-transform: uppercase; color: #64748b; letter-spacing: 1px; }

        .risk-badge {
            text-align: center;
            padding: 0.8rem;
            border-radius: 6px;
            font-weight: 700;
            color: var(--white);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2rem;
            transition: background-color 0.3s;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            font-size: 0.85rem;
        }
        .metric-item {
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
        }

        .btn-export {
            display: block;
            width: 100%;
            padding: 1rem;
            background-color: var(--dark-navy);
            color: var(--white);
            text-align: center;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 2rem;
            text-transform: uppercase;
        }
        .btn-export:hover { background-color: var(--primary-blue); }

        /* Responsive */
        @media (max-width: 768px) {
            .calc-wrapper { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- NAVIGATION -->
    <header>
        <div class="nav-container">
            <div class="logo">Bioelectric<span style="color:var(--dark-navy)">Health</span></div>
            <nav>
                <ul>
                    <li><a href="#calculator">Calculator</a></li>
                    <li><a href="#concept">Concepts</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="hero">
        <div class="container" style="padding: 2rem;">
            <h1>Food Coherence Calculator v1.0</h1>
            <p>Evaluate matrix integrity and metabolic risk based on bioelectric signaling principles.</p>
        </div>
    </div>

    <!-- CALCULATOR SECTION -->
    <section id="calculator" class="container">
        <h2>Clinical Coherence Assessment</h2>
        <p style="margin-bottom: 2rem;">This tool estimates the "Food Coherence Score" (0â€“100) by analyzing processing levels (NOVA) and bioelectric modifiers ($\Delta\psi_m$, Matrix, Noise) [3, 7].</p>

        <div class="calc-wrapper">
            
            <!-- LEFT: INPUTS -->
            <div class="calc-inputs">
                <h3 style="margin-bottom: 1.5rem; font-size: 1.2rem; color: var(--primary-blue);">1. Baseline Configuration</h3>
                
                <label for="nova-select">NOVA Category (Processing Level) [1]</label>
                <select id="nova-select" onchange="updateCalculator()">
                    <option value="1">NOVA 1: Unprocessed / Minimally Processed</option>
                    <option value="2">NOVA 2: Processed Culinary Ingredients</option>
                    <option value="3">NOVA 3: Processed Foods</option>
                    <option value="4" selected>NOVA 4: Ultra-Processed Food (UPF)</option>
                </select>

                <div id="food-examples" class="food-example-box">
                    <strong>Examples:</strong> Soft drinks, packaged snacks, reconstituted meats, nuggets. <br><em>(Source: Industrial formulations, hyper-palatable, >5 ingredients) [1]</em>
                </div>

                <h3 style="margin-bottom: 1.5rem; font-size: 1.2rem; color: var(--primary-blue);">2. Bioelectric Modifiers (0-10)</h3>
                <p style="font-size: 0.8rem; color: #64748b; margin-bottom: 1rem;">Adjust based on ingredient quality and additives.</p>

                <!-- SLIDERS -->
                <label>Mitochondrial Voltage ($\Delta\psi_m$) Support [4]</label>
                <input type="range" id="voltage-slider" min="0" max="10" value="2" oninput="updateCalculator()">
                
                <label>Tissue Pattern Memory (Morphology) [4]</label>
                <input type="range" id="memory-slider" min="0" max="10" value="3" oninput="updateCalculator()">

                <label>Matrix Fragmentation (Disruption) [8]</label>
                <input type="range" id="fragmentation-slider" min="0" max="10" value="8" oninput="updateCalculator()">

                <label>Inflammatory Noise (Bioelectric Mutagens) [9]</label>
                <input type="range" id="noise-slider" min="0" max="10" value="9" oninput="updateCalculator()">
            </div>

            <!-- RIGHT: DASHBOARD (Export Target) -->
            <div class="calc-dashboard" id="clinical-report">
                <h3 style="text-align: center; margin-bottom: 1rem; color: var(--dark-navy);">Bioelectric Integrity Analysis</h3>
                
                <!-- VISUAL METER -->
                <div class="score-circle" id="score-circle">
                    <div class="score-inner">
                        <div class="score-number" id="score-display">--</div>
                        <div class="score-label">Coherence Score</div>
                    </div>
                </div>

                <!-- RISK OVERLAY -->
                <div id="risk-badge" class="risk-badge" style="background-color: var(--alert-red);">
                    CALCULATING...
                </div>

                <div class="metrics-grid">
                    <div class="metric-item">
                        <span>Classification:</span>
                        <span id="metric-class" style="font-weight: 700;">UPF</span>
                    </div>
                    <div class="metric-item">
                        <span>Matrix Integrity:</span>
                        <span id="metric-integrity">Compromised</span>
                    </div>
                    <div class="metric-item">
                        <span>Immune Recognition:</span>
                        <span id="metric-immune">Foreign (Noise)</span>
                    </div>
                    <div class="metric-item">
                        <span>Recovery Slope:</span>
                        <span id="metric-slope">Slow/Drift</span>
                    </div>
                </div>

                <p style="font-size: 0.7rem; color: #94a3b8; margin-top: 2rem; text-align: center;">
                    *Not medical advice. Based on Food Coherence System v1.0 [3].<br>
                    High scores indicate support for stable bioelectric signaling.
                </p>

                <!-- EXPORT BUTTON (Excluded from PDF usually, but keeping simple here) -->
                <button class="btn-export" id="export-btn" onclick="generatePDF()">Download Clinical PDF</button>
            </div>
        </div>
    </section>

    <!-- SCRIPT FOR CALCULATOR LOGIC & PDF -->
    <script>
        // DATA DICTIONARY FOR NOVA CATEGORIES [1, 2]
        const novaData = {
            1: {
                base: 90,
                desc: "<strong>Examples:</strong> Fresh fruits, raw meat, eggs, plain milk, vegetables.<br><em>(Source: Unprocessed biological signals, 'Goldilocks Zone' compatible) [2]</em>"
            },
            2: {
                base: 75,
                desc: "<strong>Examples:</strong> Butter, salt, sugar, oils used in cooking.<br><em>(Source: Processed culinary ingredients) [2]</em>"
            },
            3: {
                base: 55,
                desc: "<strong>Examples:</strong> Canned vegetables, freshly made bread, cheese, smoked meats.<br><em>(Source: Processed foods, matrix altered but recognizable) [2]</em>"
            },
            4: {
                base: 25,
                desc: "<strong>Examples:</strong> Soft drinks, nuggets, reconstituted meats, mass-produced bread.<br><em>(Source: Industrial formulations, hyper-palatable, >5 ingredients) [1]</em>"
            }
        };

        function updateCalculator() {
            // 1. Get Inputs
            const novaLevel = document.getElementById('nova-select').value;
            const voltage = parseInt(document.getElementById('voltage-slider').value);
            const memory = parseInt(document.getElementById('memory-slider').value);
            const frag = parseInt(document.getElementById('fragmentation-slider').value);
            const noise = parseInt(document.getElementById('noise-slider').value);

            // 2. Update Description Box
            document.getElementById('food-examples').innerHTML = novaData[novaLevel].desc;

            // 3. Calculate Score (Algorithm Concept from [3])
            // Formula: Base - (Fragmentation + Noise) + (Voltage + Memory)
            // We normalize to ensure 0-100 range.
            
            let baseScore = novaData[novaLevel].base;
            
            // Modifiers: Max impact of +/- 15 points each
            let positiveImpact = (voltage + memory) * 1.5; // Max 30
            let negativeImpact = (frag + noise) * 2.0;     // Max 40 (Penalize noise heavily per [10])

            let finalScore = baseScore + positiveImpact - negativeImpact;

            // Clamp score between 0 and 100
            if (finalScore > 100) finalScore = 100;
            if (finalScore < 0) finalScore = 0;
            
            finalScore = Math.round(finalScore);

            // 4. Update Dashboard UI
            const scoreDisplay = document.getElementById('score-display');
            const scoreCircle = document.getElementById('score-circle');
            const riskBadge = document.getElementById('risk-badge');
            
            scoreDisplay.innerText = finalScore;

            // 5. Determine State (Green/Orange/Red) [5]
            let color, label, integrity, immune, slope;

            if (finalScore >= 80) {
                // LOW RISK / HIGH COHERENCE
                color = "var(--success-green)";
                label = "ðŸŸ¢ LOW RISK (High Coherence)";
                integrity = "Intact (Signal)";
                immune = "Compatible";
                slope = "Fast Recovery";
            } else if (finalScore >= 50) {
                // MODERATE RISK
                color = "var(--warning-orange)";
                label = "ðŸŸ  MODERATE RISK (Conditional)";
                integrity = "Partial Loss";
                immune = "Low-Grade Alert";
                slope = "Delayed";
            } else {
                // HIGH RISK / UPF
                color = "var(--alert-red)";
                label = "ðŸ”´ HIGH RISK (Bioelectric Mutagen)";
                integrity = "Fragmented";
                immune = "Inflammatory Noise";
                slope = "Drift / Hysteresis";
            }

            // Apply Visuals
            scoreCircle.style.setProperty('--score-color', color);
            scoreCircle.style.setProperty('--score-percent', finalScore + '%');
            riskBadge.style.backgroundColor = color;
            riskBadge.innerText = label;

            // Update Text Metrics
            document.getElementById('metric-integrity').innerText = integrity;
            document.getElementById('metric-immune').innerText = immune;
            document.getElementById('metric-slope').innerText = slope;
            document.getElementById('metric-class').innerText = "NOVA " + novaLevel;
        }

        // PDF GENERATION FUNCTION
        function generatePDF() {
            const element = document.getElementById('clinical-report');
            const opt = {
                margin:       1,
                filename:     'Food_Coherence_Report.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            
            // Hide the button for the PDF, then show it again
            const btn = document.getElementById('export-btn');
            btn.style.display = 'none';
            
            html2pdf().set(opt).from(element).save().then(() => {
                btn.style.display = 'block';
            });
        }

        // Initialize on load
        window.onload = updateCalculator;
    </script>
</body>
</html>
