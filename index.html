<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Coherence System | Bioelectric Dashboard</title>
    
    <!-- External Libraries for UX (Icons, Charts, PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- UX THEME: "MEDICAL FUTURISM" --- */
        :root {
            /* Source [6]: "Signal Quality (Cobalt Blue #0047AB)" */
            --primary-blue: #0047AB; 
            --deep-navy: #0f172a;
            --medical-bg: #f8fafc;
            --surface-white: #ffffff;
            --text-main: #334155;
            --text-light: #64748b;
            
            /* Status Colors */
            --signal-green: #10b981; /* Coherence */
            --noise-red: #ef4444;     /* Mutagen/Static */
            --warning-orange: #f59e0b;
            
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
        }

        /* RESET & BASE */
        * { box-sizing: border-box; margin: 0; padding: 0; scroll-behavior: smooth; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--medical-bg); color: var(--text-main); line-height: 1.6; }

        /* NAVIGATION - Sticky & Glassmorphism */
        nav {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 2rem;
        }
        .nav-content { max-width: 1280px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--deep-navy); letter-spacing: -0.5px; display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--primary-blue); }
        .nav-links a { text-decoration: none; color: var(--text-main); font-weight: 600; margin-left: 2rem; transition: color 0.2s; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .nav-links a:hover { color: var(--primary-blue); }

        /* HERO SECTION - "The Signal" */
        .hero {
            background: linear-gradient(135deg, var(--deep-navy) 0%, #1e293b 100%);
            color: var(--surface-white);
            padding: 6rem 2rem;
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            /* Abstract Sine Wave Background representing Coherence [2] */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='20' viewBox='0 0 100 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M21.184 20c.357-.13.72-.264 1.088-.402l1.768-.661C33.64 15.347 39.647 14 50 14c10.271 0 15.36 1.222 24.629 4.928.955.374 1.949.747 2.996 1.08l1.19.29.993-1.741c-.633-.36-1.291-.703-1.97-1.026-8.591-4.076-14.39-5.535-24.839-5.535-11.233 0-16.126 1.488-25.79 5.37-1.396.56-2.822 1.09-4.28 1.57L21.184 20z' fill='%230047AB' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.3;
        }
        .hero-content { max-width: 900px; margin: 0 auto; text-align: center; position: relative; z-index: 10; }
        .hero h1 { font-size: 3.5rem; font-weight: 800; margin-bottom: 1.5rem; letter-spacing: -1px; line-height: 1.1; }
        .hero p { font-size: 1.25rem; opacity: 0.9; max-width: 700px; margin: 0 auto 2.5rem; }
        .hero-btn {
            background: var(--primary-blue); color: white; padding: 1rem 2.5rem; border-radius: 50px;
            text-decoration: none; font-weight: 700; transition: transform 0.2s, box-shadow 0.2s;
            display: inline-flex; align-items: center; gap: 10px;
        }
        .hero-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 71, 171, 0.4); }

        /* GRID LAYOUTS */
        .container { max-width: 1280px; margin: 0 auto; padding: 4rem 2rem; }
        .section-title { text-align: center; margin-bottom: 3rem; }
        .section-title h2 { font-size: 2.2rem; color: var(--deep-navy); margin-bottom: 0.5rem; }
        .section-title p { color: var(--text-light); max-width: 600px; margin: 0 auto; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; align-items: center; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }

        /* INTERACTIVE CARDS [Source 38 - The Gaps] */
        .feature-card {
            background: var(--surface-white); padding: 2rem; border-radius: var(--radius);
            box-shadow: var(--shadow-card); transition: all 0.3s ease; border-top: 4px solid transparent;
        }
        .feature-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); border-top-color: var(--primary-blue); }
        .feature-icon { font-size: 2rem; color: var(--primary-blue); margin-bottom: 1.5rem; }
        .feature-card h3 { margin-bottom: 1rem; color: var(--deep-navy); }

        /* TOGGLE SECTION (Paradigm Shift) */
        .paradigm-toggle {
            background: var(--white); border-radius: 20px; overflow: hidden; margin-top: 2rem;
            box-shadow: var(--shadow-card); display: flex;
        }
        .paradigm-side { flex: 1; padding: 3rem; transition: 0.3s; cursor: pointer; position: relative; }
        .paradigm-side:hover { background: #f1f5f9; }
        .paradigm-side.active { background: #e0f2fe; }
        .paradigm-side.active h3 { color: var(--primary-blue); }

        /* DASHBOARD / CALCULATOR STYLES */
        .dashboard-wrapper {
            background: var(--surface-white); border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden; border: 1px solid #e2e8f0; display: grid; grid-template-columns: 400px 1fr;
        }
        
        /* Left Control Panel */
        .controls { background: #f8fafc; padding: 2.5rem; border-right: 1px solid #e2e8f0; }
        .control-group { margin-bottom: 2rem; }
        label { display: block; font-weight: 700; margin-bottom: 0.8rem; color: var(--text-main); font-size: 0.9rem; }
        
        /* Custom Inputs */
        select, input[type="range"] { width: 100%; display: block; }
        select { padding: 0.8rem; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.95rem; background: white; cursor: pointer; }
        
        /* Range Sliders with Track Styling */
        input[type=range] { -webkit-appearance: none; height: 6px; background: #cbd5e1; border-radius: 5px; outline: none; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 22px; height: 22px; background: var(--primary-blue);
            border-radius: 50%; cursor: pointer; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Right Visualization Panel */
        .viz-panel { padding: 2.5rem; display: flex; flex-direction: column; }
        .chart-container { position: relative; height: 300px; width: 100%; display: flex; justify-content: center; margin-bottom: 2rem; }
        
        .score-display {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1.5rem; background: var(--deep-navy); color: white; border-radius: 12px;
            margin-bottom: 2rem;
        }
        .score-value { font-size: 2.5rem; font-weight: 800; line-height: 1; }
        .score-label { font-size: 0.9rem; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px; }

        .analysis-box {
            background: #fff; border: 1px solid #e2e8f0; padding: 1.5rem; border-radius: 12px; margin-top: auto;
        }
        .alert-pill {
            display: inline-block; padding: 4px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
            background: #fee2e2; color: #b91c1c; margin-bottom: 0.5rem;
        }
        
        /* FOOTER */
        footer { background: var(--deep-navy); color: #94a3b8; padding: 4rem 2rem; text-align: center; font-size: 0.9rem; }
        footer a { color: white; text-decoration: none; }

        @media (max-width: 900px) {
            .dashboard-wrapper { grid-template-columns: 1fr; }
            .controls { border-right: none; border-bottom: 1px solid #e2e8f0; }
            .grid-2 { grid-template-columns: 1fr; }
            .hero h1 { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

    <!-- NAV -->
    <nav>
        <div class="nav-content">
            <div class="logo">
                <i class="fa-solid fa-wave-square"></i>
                Food<span>Coherence</span>
            </div>
            <div class="nav-links">
                <a href="#paradigm">Paradigm</a>
                <a href="#toxemia">Toxemia</a>
                <a href="#calculator" style="color:var(--primary-blue);">Calculator</a>
            </div>
        </div>
    </nav>

    <!-- HERO: "Clear Decisions Start on Your Plate" [Source 1] -->
    <header class="hero">
        <div class="hero-content">
            <h1>Food is Not Just Fuel.<br>It's Information.</h1>
            <p>Moving beyond the "Calorie Model" to understand bioelectric signaling. Is your meal building coherence, or is it creating chaos?</p>
            <a href="#calculator" class="hero-btn">
                <i class="fa-solid fa-calculator"></i> Measure Your Coherence
            </a>
        </div>
    </header>

    <!-- SECTION 1: THE SIGNAL VS NOISE [Source 5, 173] -->
    <section id="paradigm" class="container">
        <div class="section-title">
            <h2>The Bioelectric Paradigm</h2>
            <p>Your brain and body function like an orchestra. Food is the tuning fork.</p>
        </div>

        <div class="grid-2">
            <div>
                <img src="images/bioelectric_signal.jpeg" alt="Bioelectric Signal Comparison" style="width:100%; border-radius: var(--radius); box-shadow: var(--shadow-card);">
                <p style="font-size: 0.8rem; color: #64748b; margin-top: 10px; text-align: center;">Figure 1: Coherent instructional signals vs. Bioelectric Mutagens [Source 173]</p>
            </div>
            <div>
                <div class="feature-card" style="margin-bottom: 1.5rem;">
                    <i class="fa-solid fa-bolt feature-icon" style="color: var(--signal-green);"></i>
                    <h3>Coherence (The Signal)</h3>
                    <p>Whole foods provide stable instructions that maintain mitochondrial voltage ($\Delta\psi_m$) and pattern memory. The immune system recognizes this as "Self."</p>
                </div>
                <div class="feature-card">
                    <i class="fa-solid fa-burst feature-icon" style="color: var(--noise-red);"></i>
                    <h3>Mutagens (The Noise)</h3>
                    <p>Ultra-Processed Foods (UPFs) act as "Bioelectric Mutagens." They create signaling static, forcing the system into low-power, inflammatory states.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 2: TOXEMIA & QUARANTINE [Source 92, 73] -->
    <section id="toxemia" style="background: white; padding: 4rem 0;">
        <div class="container">
            <div class="grid-2">
                <div>
                    <h2 style="margin-bottom: 1.5rem;">Why You Can't Lose Weight</h2>
                    <h3 style="color: var(--primary-blue); margin-bottom: 1rem;">The "Quarantine Zone" Hypothesis</h3>
                    <p style="margin-bottom: 1rem;">It's not just about calories. When you consume lipophilic (fat-loving) toxins from preservatives and plastics, your body must protect vital organs (Heart, Brain).</p>
                    <p style="margin-bottom: 1.5rem;"><strong>The Defense:</strong> The body creates adipose tissue (fat) to sequester these toxins. Losing weight rapidly releases them, causing "Re-intoxication," so the body halts fat loss to protect you [Source 92].</p>
                    <div style="padding: 1rem; background: #fff1f2; border-left: 4px solid var(--noise-red); border-radius: 4px;">
                        <strong><i class="fa-solid fa-triangle-exclamation"></i> The Cocktail Effect:</strong> <br>
                        Testing additives in isolation (A + B) misses the synergy (A x B). This synergy creates the "Metabolic Noise" that confuses the immune system [Source 145].
                    </div>
                </div>
                <div style="position: relative;">
                     <img src="images/toxemia_mechanism.jpg" alt="Adipose Quarantine Zone" style="width:100%; border-radius: var(--radius); box-shadow: var(--shadow-card);">
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 3: INTERACTIVE CALCULATOR [Updated with Source 156 Salami Logic] -->
    <section id="calculator" class="container">
        <div class="section-title">
            <h2>Clinical Coherence Calculator</h2>
            <p>Estimate the "Matrix Integrity" and bioelectric impact of food.</p>
        </div>

        <div class="dashboard-wrapper" id="clinical-report">
            
            <!-- CONTROLS -->
            <div class="controls">
                <div class="control-group">
                    <label>Quick Preset (Simulation)</label>
                    <select id="food-preset" onchange="applyPreset()">
                        <option value="custom">-- Custom Analysis --</option>
                        <option value="apple">Organic Apple (Whole Food)</option>
                        <option value="bread">Artisan Sourdough (Processed)</option>
                        <option value="salami">Commercial Salami (UPF/Nitrites)</option>
                        <option value="soda">Diet Soda (UPF/Artificial)</option>
                    </select>
                </div>

                <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 2rem 0;">

                <div class="control-group">
                    <label>NOVA Classification [Source 141]</label>
                    <select id="nova-input" onchange="calculateCoherence()">
                        <option value="1">NOVA 1: Unprocessed / Minimally Processed</option>
                        <option value="2">NOVA 2: Processed Culinary Ingredients</option>
                        <option value="3">NOVA 3: Processed Foods</option>
                        <option value="4">NOVA 4: Ultra-Processed (UPF)</option>
                    </select>
                </div>

                <div class="control-group">
                    <div style="display: flex; justify-content: space-between;">
                        <label>Matrix Fragmentation</label>
                        <span id="val-frag" style="font-size: 0.8rem; font-weight: 700;">5</span>
                    </div>
                    <input type="range" id="input-frag" min="0" max="10" value="5" oninput="calculateCoherence()">
                    <p style="font-size: 0.75rem; color: #94a3b8; margin-top: 5px;">Physical destruction of fiber structure.</p>
                </div>

                <div class="control-group">
                    <div style="display: flex; justify-content: space-between;">
                        <label>Bioelectric Noise (Mutagens)</label>
                        <span id="val-noise" style="font-size: 0.8rem; font-weight: 700;">5</span>
                    </div>
                    <input type="range" id="input-noise" min="0" max="10" value="5" oninput="calculateCoherence()">
                    <p style="font-size: 0.75rem; color: #94a3b8; margin-top: 5px;">Presence of emulsifiers, nitrites, sweeteners.</p>
                </div>
            </div>

            <!-- VISUALIZATION -->
            <div class="viz-panel">
                <div class="score-display">
                    <div>
                        <div class="score-label">Coherence Score</div>
                        <div class="score-value" id="final-score">--</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="score-label">Risk Level</div>
                        <div id="risk-text" style="font-weight: 700; color: var(--signal-green);">LOW</div>
                    </div>
                </div>

                <!-- Chart.js Canvas -->
                <div class="chart-container">
                    <canvas id="coherenceChart"></canvas>
                </div>

                <div class="analysis-box">
                    <span class="alert-pill" id="analysis-badge">Waiting for Input</span>
                    <p id="analysis-text" style="font-size: 0.9rem; margin-top: 0.5rem; color: var(--text-main);">
                        Select a food or adjust sliders to see the bioelectric impact on your immune system.
                    </p>
                </div>

                <button onclick="downloadPDF()" style="margin-top: 1rem; background: transparent; border: 1px solid #cbd5e1; padding: 10px; border-radius: 8px; cursor: pointer; color: var(--text-light); font-size: 0.85rem;">
                    <i class="fa-solid fa-download"></i> Download Clinical Report
                </button>
            </div>
        </div>
    </section>

    <!-- SECTION 4: THE UPSTREAM ADDRESS [Source 133, 172] -->
    <section id="upstream" class="container">
        <div class="section-title">
            <h2>The Upstream Address</h2>
            <p>Chronic disease is a predictable output of industrial design. We must change the default.</p>
        </div>
        <img src="images/upstream_address.png" alt="Upstream River Flow" style="width: 100%; border-radius: var(--radius); margin-bottom: 2rem;">
        
        <div class="grid-3">
            <div class="feature-card">
                <i class="fa-solid fa-industry feature-icon"></i>
                <h3>Commodity Incentives</h3>
                <p>Subsidies make corn/soy cheap, making HFCS and Soybean oil the default substrate for processed food [Source 135].</p>
            </div>
            <div class="feature-card">
                <i class="fa-solid fa-eye-slash feature-icon"></i>
                <h3>Industrial Opacity</h3>
                <p>Supply chains function better when consumers do not see the full chain. Origins are obscured [Source 104].</p>
            </div>
            <div class="feature-card">
                <i class="fa-solid fa-scale-unbalanced feature-icon"></i>
                <h3>Externalities</h3>
                <p>High-throughput production scales by concentrating harms (waste, pollution) onto public health [Source 105].</p>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <p style="margin-bottom: 1rem; font-weight: 700; color: white;">Food Coherence Research Initiative (2026)</p>
            <p style="max-width: 600px; margin: 0 auto; opacity: 0.7;">
                Disclaimer: The "Food Coherence Score" and "Bioelectric Mutagen" concepts are hypothesis-generating frameworks based on the Prevent-OO 2026 research call. Not medical advice.
            </p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // CHART.JS SETUP
        let ctx = document.getElementById('coherenceChart').getContext('2d');
        let coherenceChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['Mitochondrial Voltage', 'Pattern Memory', 'Gut Integrity', 'Enzyme Stability', 'Immune Silence'],
                datasets: [{
                    label: 'Bioelectric Profile',
                    data: [7],
                    backgroundColor: 'rgba(0, 71, 171, 0.2)',
                    borderColor: '#0047AB',
                    borderWidth: 2,
                    pointBackgroundColor: '#0047AB'
                }]
            },
            options: {
                scales: {
                    r: {
                        suggestedMin: 0,
                        suggestedMax: 100,
                        grid: { color: '#e2e8f0' },
                        pointLabels: { font: { size: 12, weight: 'bold' }, color: '#334155' }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });

        // PRESET DATA [Sources 156, 141, 159]
        const presets = {
            'apple': { nova: 1, frag: 1, noise: 0, text: "High Coherence: Signal matches evolutionary history. High voltage support." },
            'bread': { nova: 3, frag: 5, noise: 3, text: "Moderate: Matrix is altered (ground flour), but fermentation may aid digestion." },
            'salami': { nova: 4, frag: 8, noise: 9, text: "High Risk: Nitrites transform into Nitrosylheme (Mutagen). Synergy of salts and phosphates creates high metabolic noise [Source 159]." },
            'soda': { nova: 4, frag: 10, noise: 10, text: "Incoherent: Liquid sugar/sweeteners. Zero matrix. Direct gut barrier erosion." }
        };

        function applyPreset() {
            const val = document.getElementById('food-preset').value;
            if(val !== 'custom') {
                const data = presets[val];
                document.getElementById('nova-input').value = data.nova;
                document.getElementById('input-frag').value = data.frag;
                document.getElementById('input-noise').value = data.noise;
                calculateCoherence();
            }
        }

        function calculateCoherence() {
            // Get inputs
            const nova = parseInt(document.getElementById('nova-input').value);
            const frag = parseInt(document.getElementById('input-frag').value);
            const noise = parseInt(document.getElementById('input-noise').value);
            
            // Update Labels
            document.getElementById('val-frag').innerText = frag;
            document.getElementById('val-noise').innerText = noise;

            // ALGORITHM [Concept from Source 43 - FCI]
            // Base score derived from NOVA (95, 75, 50, 25)
            let base = nova === 1 ? 95 : nova === 2 ? 75 : nova === 3 ? 55 : 25;
            
            // Penalties
            let penalty = (frag * 2.5) + (noise * 4); // Noise is weighted heavier due to "Cocktail Effect"
            let score = Math.max(0, Math.round(base - penalty + 10)); // +10 buffer
            if (score > 100) score = 100;

            // Update UI
            document.getElementById('final-score').innerText = score;
            
            // Colors & Status
            let color = score > 80 ? '#10b981' : score > 50 ? '#f59e0b' : '#ef4444';
            let risk = score > 80 ? 'OPTIMAL' : score > 50 ? 'MODERATE' : 'HIGH RISK';
            
            document.getElementById('risk-text').innerText = risk;
            document.getElementById('risk-text').style.color = color;
            document.querySelector('.score-display').style.background = score > 50 ? 'var(--deep-navy)' : '#7f1d1d'; // Turn red if critical

            // Update Chart Data (Simulated Physics)
            coherenceChart.data.datasets.borderColor = color;
            coherenceChart.data.datasets.pointBackgroundColor = color;
            coherenceChart.data.datasets.backgroundColor = score > 80 ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)';
            
            // Map score to radar axes
            coherenceChart.data.datasets.data = [
                score,                  // Voltage
                score - (frag * 2),     // Memory (impacted by frag)
                100 - (noise * 8),      // Gut (impacted by noise)
                score,                  // Enzyme
                100 - (noise * 5)       // Immune Silence
            ].map(x => Math.max(0, x));
            
            coherenceChart.update();

            // Update Analysis Text
            const presetVal = document.getElementById('food-preset').value;
            let analysis = "";
            if(presetVal !== 'custom') {
                analysis = presets[presetVal].text;
            } else {
                if(score < 50) analysis = "Warning: High probability of Bioelectric Mutagen activity. Likely to induce immune scanning and inflammation.";
                else if(score < 80) analysis = "Conditional: Matrix is partially compromised. Metabolic cost is elevated.";
                else analysis = "Optimal: Signal fidelity is high. Supports regenerative biology.";
            }
            
            document.getElementById('analysis-text').innerText = analysis;
            
            const badge = document.getElementById('analysis-badge');
            badge.innerText = risk;
            badge.style.background = score > 80 ? '#d1fae5' : score > 50 ? '#fef3c7' : '#fee2e2';
            badge.style.color = score > 80 ? '#065f46' : score > 50 ? '#92400e' : '#b91c1c';
        }

        function downloadPDF() {
            const element = document.getElementById('clinical-report');
            html2pdf(element);
        }

        // Init
        calculateCoherence();

    </script>
</body>
</html>
